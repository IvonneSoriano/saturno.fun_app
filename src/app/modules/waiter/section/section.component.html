<div class="saturno-bg-tile-1">
  <div class="saturno-card saturno-bg-grey-5 shadow-box animated fadeIn">

    <div *ngIf="loading" class="mt-5 animated fadeIn">
      <mat-spinner></mat-spinner>
    </div>

    <div *ngIf="!loading" class="animated fadeIn">

      <!-- ======================================================== -->
      <!-- TABLES OF SECTION -->
      <!-- ======================================================== -->
      <div *ngFor="let table of tables">

        <div class="card bg-light mb-4">
          <div class="card-header banner-title">
            <span>
              MESA {{ table?.nm_table }}
            </span>
            <span *ngIf="comingClient">
              <span class="mdi mdi-walk" style="float: right; color: green; font-size: x-large;"></span>
            </span>
          </div>
          <div class="card-body">
            <div class="container">

              <!------------------------------>
              <!-- EN ATENCIÃ“N -->
              <!------------------------------>

              <div *ngIf="table.tx_status==='busy'">
                <div>

                  Atendiendo turnos

                </div>
                <div class="banner-content xxxxl">
                  <div class="xxxl">
                    {{ table.ticket.id_position }}
                  </div>
                </div>
              </div>

              <!------------------------------>
              <!-- OCIOSO -->
              <!------------------------------>

              <div *ngIf='message'>
                {{message}}
              </div>

            </div>
          </div>
          <!------------------------------>
          <!-- TIEMPOS DE ATENCION -->
          <!------------------------------>
          <div class="card-footer">
            <div class="row">
              <div class="col p-0">
                <div>TE</div>
                <div>{{tmWaitingStr}}</div>
              </div>
              <div class="col p-0">
                <div>TA</div>
                <div>{{tmAttention}}</div>
              </div>
              <div class="col p-0">
                <div>Tm</div>
                <div>{{timerCount}}</div>
              </div>
              <div class="col p-0">
                <div>TC</div>
                <div>{{pendingTicketsCount}}</div>
              </div>
            </div>
          </div>


        </div>

      </div>
      <!-- ======================================================== -->
      <!-- TABLES TABLE -->
      <!-- ======================================================== -->

      <div class="card bg-secondary mb-4">
        <div class="card-content table-responsive-sm  p-2">
          <mat-radio-group [(ngModel)]="sectionSelected">

            <table class="table table-sm text-white text-center">

              <tr style="border-top: 0px; color: yellow;">
                <td style="text-align: left; border: none;"></td>
                <td style="text-align: left; border: none;"> Sector </td>
                <td style="text-align: right; border: none;"> En espera </td>
              </tr>

              <tr *ngFor="let section of pendingBySection">
                <td style="padding: 0; vertical-align: middle; font-size: 16px;">
                  <!-- section of waiter -->
                  <span *ngIf="section.assigned" class="mdi mdi-check" style="color: greenyellow"></span>

                  <!-- other sections -->
                  <span *ngIf="!section.assigned && !waitForClient && tickets">
                    <mat-radio-button [value]="section.id" style="position: relative;
                left: 4px;
                top: 4px;"></mat-radio-button>
                  </span>
                </td>
                <td style="text-align: left;">
                  {{ section.tx_section }}
                </td>
                <td style="text-align: right;">
                  {{ section.tickets.length }}
                </td>
              </tr>

            </table>

          </mat-radio-group>

        </div>

      </div>

    </div>
  </div>
</div>


<!------------------------------>
<!-- ACTIONS -->
<!------------------------------>

<div class="container bg-light fixed-bottom shadow-box no-radius text-center py-1">
  <div class="row" *ngFor="let ticket of tickets">

    <div class="col button-content">
      <!-- priority slide -->
      <mat-slide-toggle [(ngModel)]="blPriority" class="mx-2 my-1"
        [disabled]="waitForClient || !tickets || sectionSelected === ''">
        <span class="mdi mdi-human-wheelchair xl mx-1"></span>
      </mat-slide-toggle>
    </div>

    <div class="col button-content">
      <button class="btn btn-success button"
        [ngClass]="{'button-disabled':waitForClient || !tickets || sectionSelected === ''}"
        [disabled]="waitForClient || !tickets || sectionSelected === ''" (click)="reassignTicket(ticket)">
        <!-- reassign ticket -->
        <div>
          <div class="mdi mdi-list-status xl"></div>
        </div>
        <div class="button-inner">
          Reasignar
        </div>
      </button>
    </div>

    <div class="col button-content">
      <!-- next ticket -->
      <button class="btn btn-success button" [disabled]="waitForClient || tickets"
        [ngClass]="{'button-disabled': waitForClient || tickets}" (click)="takeTicket()">
        <div>
          <div class="mdi mdi-chevron-right xl"></div>
        </div>
        <div class="button-inner">
          Siguiente
        </div>
      </button>
    </div>

    <div class="col button-content">
      <!-- release ticket -->
      <button class="btn btn-success button" (click)="releaseTicket(ticket)"
        [disabled]="waitForClient || !tickets"
        [ngClass]="{'button-disabled': waitForClient || !tickets}">
        <div>
          <div class="mdi mdi-replay xl"></div>
        </div>
        <div class="button-inner">
          Soltar
        </div>
      </button>
    </div>

    <div class="col button-content">
      <!-- end ticket -->
      <button class="btn btn-success button" (click)="endTicket(ticket)"
        [disabled]="waitForClient || !tickets"
        [ngClass]="{'button-disabled': waitForClient || !tickets}">
        <div>
          <div class="mdi mdi-close xl"></div>
        </div>
        <div class="button-inner">
          Finalizar
        </div>
      </button>
    </div>

    <div class="col button-content">
      <button class="btn btn-danger button" (click)="releaseSection()" [disabled]="waitForClient"
        [ngClass]="{'button-disabled': waitForClient}">
        <div>
          <div class="mdi mdi-power xl"></div>
        </div>
        <div class="button-inner">
          Salir
        </div>
      </button>
    </div>

  </div>
</div>